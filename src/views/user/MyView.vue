<template>
  <div style="padding: 20px">
    <a-row :gutter="16">
      <a-col :span="9">
        <a-card hoverable style="width: 350px;">
          <template #cover>
            <img
                alt="我的卡片"
                src="https://ts1.cn.mm.bing.net/th/id/R-C.cfecd1c8ad99d69ae96938888c97dfae?rik=Y1F6p7CiWAJGIA&riu=http%3a%2f%2fi0.hdslb.com%2fbfs%2farticle%2f8fa565f57f61181b6b9243f340710b5a889bc37b.jpg&ehk=jCfQa5pGHULXCgDFkFraDn8y5Q2SQT50yk8ADTFS8NM%3d&risl=&pid=ImgRaw&r=0"
            />
          </template>
          <template #actions>
            <a
                href="https://github.com/CodeSailor-zero"
                target="_blank"
                rel="noopener noreferrer"
            >
              <a-avatar
                  src="https://github.githubassets.com/favicons/favicon.svg"
                  width="30px"
                  height="30px"
              />
            </a>
            <a-button
                type="link"
                style="color: red;font-weight: bold"
                @click="ToSignView"
            >
              签到
            </a-button>
            <a-popover title="Title" trigger="click" placement="bottomLeft">
              <template #content>
                <div style="margin-bottom: 10px">
                  <router-link to="/user/edit">
                    用户信息修改
                    <EditTwoTone style="height: 50px;width: 50px"/>
                  </router-link>
                </div>
                <div>

                  <router-link to="/user/avatar/edit">
                    用户头像修改
                    <svg t="1742653675232" class="icon" viewBox="0 0 1024 1024" version="1.1"
                         xmlns="http://www.w3.org/2000/svg" p-id="14051" width="16" height="16">
                      <path
                          d="M160.3 940.36h699S850 765.93 674.3 668c0 0 111-92.61 112.26-216.72l4-122.84s25.16-228.55-285.43-226-268.3 267-268.3 267l-4 88.59s2.54 140 108.25 208.89c0.2 0.08-155.83 116.34-180.78 273.44z"
                          fill="#FCCF00" p-id="14052"></path>
                      <path
                          d="M372.79 639.92l-0.64-0.64c-67.87-53.7-96.83-108.67-96.83-183.94a31.08 31.08 0 1 0-62.16 0C213.16 538 243 605 306.4 664.44c-96.62 75.69-150.12 153.29-176.33 253.77a31.26 31.26 0 0 0 22.2 37.84 32.74 32.74 0 0 0 7.82 1.06 31.11 31.11 0 0 0 30-23.26c24.95-96 79.92-168.51 184-242.72a30.89 30.89 0 0 0 7.22-43.07V648a30.49 30.49 0 0 0-8.52-8.08zM895 918.21C868.61 817.94 815.73 741 721.43 666.77c64.91-59.2 95.36-127.28 95.36-211.22a31.08 31.08 0 0 0-62.16-0.06v0.06c0 75.06-30.24 132.14-98.1 184.79a30.57 30.57 0 0 0-3.81 52.43c103.81 74 156.46 144 182.25 241.24a30.91 30.91 0 0 0 30 23 33.41 33.41 0 0 0 7.83-1.01 30.75 30.75 0 0 0 22.35-37.29c-0.05-0.17-0.09-0.33-0.15-0.5zM240 390.64a30.77 30.77 0 0 0 25.2-35.47v-0.26c-0.21-0.85-14.17-87.74 39.54-151.38C345.3 155.32 415.07 131 511.91 131s166.82 24.52 207.62 72.52c54.13 63.64 40.6 150.53 40.38 151.17a30.81 30.81 0 0 0 25 35.67l0.36 0.06a46.57 46.57 0 0 0 5.28 0.42A30.83 30.83 0 0 0 821 365.06c0.84-4.65 18.81-115.23-53.71-201.28-53.28-63-139.12-95.14-255.4-95.14s-202.13 31.92-255 95.14c-72.09 86.05-53.7 196.63-52.85 201.28 3.2 17.34 19.27 28.54 35.96 25.58z"
                          fill="#231815" p-id="14053"></path>
                      <path
                          d="M402.61 369.08a31.11 31.11 0 0 0-31.09 31.13v33a31.08 31.08 0 1 0 62.16 0v-33a31.28 31.28 0 0 0-31.07-31.13zM622.91 369.08a31.11 31.11 0 0 0-31.08 31.13v33a31.08 31.08 0 0 0 62.16 0v-33a31.27 31.27 0 0 0-31.08-31.13zM589.08 500a31.1 31.1 0 0 0-42.71 8.67c-0.21 0.21-13.53 19.66-33.83 19.66-19.87 0-32.14-18-33-19.24a31 31 0 0 0-52.44 33c11.21 18 41.66 48.21 85.42 48.21 43.56 0 74.43-30 85.83-47.78a31 31 0 0 0-9.27-42.52z"
                          fill="#231815" p-id="14054"></path>
                    </svg>
                  </router-link>
                </div>
              </template>
              <EllipsisOutlined style="height: 31px;width: 31px"/>
            </a-popover>
          </template>
          <a-card-meta :title="loginUser?.userName">
            <template #avatar>
              <a-avatar :src="loginUser?.userAvatar"/>
            </template>
          </a-card-meta>
        </a-card>
      </a-col>
      <a-col :span="7">
        <a-card hoverable
                style="width: 250px;height: 250px;"
        >
          <template #cover>
            <img
                alt="背景图"
                src="https://tse2-mm.cn.bing.net/th/id/OIP-C.eVeIJ9l1YraZrLOQEkrAlAHaEK?rs=1&pid=ImgDetMain"
            />
          </template>
          <template #actions>
            <a-button type="link"
                      style="color: #fda085;font-weight: bold"
                      @click="router.push('/user/exchange')"
            >
              兑换
            </a-button>
          </template>
          <a-card-meta>
            <template #title>
              <h3 style="color: rgba(194,30,30,0.55);font-weight: bold;text-align: center">
                可用积分： {{ userScore }} 积分
              </h3>
            </template>
          </a-card-meta>
        </a-card>
      </a-col>
      <a-col :span="7">
        <a-card hoverable
                style="width: 250px;height: 275px;"
        >
          <template #cover>
            <img
                alt="背景图"
                src="https://media.9game.cn/gamebase/ieu-eagle-docking-service/images/20230417/12/12/8c0876daa0c7d2256fb823d68be84287.png"
            />
          </template>
          <a-card-meta>
            <template #title>
              <h3 style="color: rgba(194,30,30,0.55);font-weight: bold;text-align: center;margin-top: 20px">
                <template v-if="!isSign">
                  <svg t="1741528096775" class="icon" viewBox="0 0 1024 1024" version="1.1"
                       xmlns="http://www.w3.org/2000/svg" p-id="8566" width="32" height="32">
                    <path
                        d="M512 56.888889a512 512 0 0 1 512 512c0 282.737778-229.262222 398.222222-512 398.222222S0 851.626667 0 568.888889A512 512 0 0 1 512 56.888889z"
                        fill="#F9D342" p-id="8567"></path>
                    <path
                        d="M238.933333 716.8a102.4 102.4 0 1 1-102.4 102.4 102.4 102.4 0 0 1 102.4-102.4z m546.133334 0a102.4 102.4 0 1 1-102.4 102.4 102.4 102.4 0 0 1 102.4-102.4z"
                        fill="#ECA61F" p-id="8568"></path>
                    <path
                        d="M238.933333 762.311111a102.4 102.4 0 1 1-102.4 102.4 102.4 102.4 0 0 1 102.4-102.4z m546.133334 0a102.4 102.4 0 1 1-102.4 102.4 102.4 102.4 0 0 1 102.4-102.4z"
                        fill="#F9D342" p-id="8569"></path>
                    <path
                        d="M512 762.311111a56.888889 56.888889 0 1 1-56.888889 56.888889 56.888889 56.888889 0 0 1 56.888889-56.888889zM318.577778 489.244444c178.972444-50.517333 169.528889-24.348444 125.155555 79.644445-27.192889 63.601778-67.356444 125.155556-136.533333 125.155555a125.087289 125.087289 0 0 1-125.155556-125.155555c0-69.176889 69.290667-60.643556 136.533334-79.644445z m379.676444 0c-178.858667-50.517333-169.528889-24.348444-125.155555 79.644445 27.192889 63.601778 67.470222 125.155556 136.647111 125.155555a125.155556 125.155556 0 0 0 125.155555-125.155555c0-69.176889-69.404444-60.643556-136.647111-79.644445z m-225.166222-111.160888s14.108444 174.876444-352.597333 138.581333c0 0 150.755556-6.030222 352.597333-138.581333z m68.266667 0S527.132444 552.96 893.838222 516.664889c0 0-150.755556-6.030222-352.483555-138.581333z"
                        fill="#4F3F00" p-id="8570"></path>
                    <path
                        d="M272.839111 512a57.116444 57.116444 0 1 1-57.116444 57.116444A57.150578 57.150578 0 0 1 272.839111 512z m103.879111-22.755556a47.160889 47.160889 0 1 1-47.104 47.104A47.047111 47.047111 0 0 1 376.718222 489.244444z m-23.893333 102.4a34.588444 34.588444 0 1 1-34.588445 34.588445A34.577067 34.577067 0 0 1 352.824889 591.644444z m391.168-79.644444a57.059556 57.059556 0 1 1-57.002667 57.116444A57.150578 57.150578 0 0 1 743.992889 512z m-103.765333-22.755556a47.104 47.104 0 1 1-47.217778 47.104A47.126756 47.126756 0 0 1 640.227556 489.244444z m23.779555 102.4a34.645333 34.645333 0 1 1-34.702222 34.702223A34.690844 34.690844 0 0 1 664.007111 591.644444z"
                        fill="#FFFFFF" p-id="8571"></path>
                    <path
                        d="M386.844444 204.8m-56.888888 0a56.888889 56.888889 0 1 0 113.777777 0 56.888889 56.888889 0 1 0-113.777777 0Z"
                        fill="#FFF6D4" p-id="8572"></path>
                  </svg>
                  未签到
                </template>
                <template v-else>
                  <svg t="1741527867063" class="icon" viewBox="0 0 1024 1024" version="1.1"
                       xmlns="http://www.w3.org/2000/svg" p-id="5068" width="32" height="32">
                    <path d="M514.286299 2.505864h3.565417V895.785974h-3.565417z" fill="#EDA639" p-id="5069"></path>
                    <path d="M69.430967 447.365225h893.276081v3.55736H69.430967z" fill="#EDA639" p-id="5070"></path>
                    <path
                        d="M517.811429 452.578389m-430.932074 0a430.932074 430.932074 0 1 0 861.864148 0 430.932074 430.932074 0 1 0-861.864148 0Z"
                        fill="#FFE770" p-id="5071"></path>
                    <path d="M520.027225 493.522274v160.145663" fill="#FFE770" p-id="5072"></path>
                    <path
                        d="M520.027225 675.024184a21.352218 21.352218 0 0 1-21.352218-21.356247v-160.145663a21.352218 21.352218 0 0 1 42.708465 0v160.145663a21.352218 21.352218 0 0 1-21.356247 21.356247z"
                        fill="#6E6E96" p-id="5073"></path>
                    <path d="M300.917211 313.051716l62.279988-62.279988 62.279988 62.279988" fill="#FFE770"
                          p-id="5074"></path>
                    <path
                        d="M425.477187 334.403934a21.299845 21.299845 0 0 1-15.099644-6.252574L363.197199 280.971016 316.016855 328.15136a21.352218 21.352218 0 1 1-30.199288-30.199288l62.279988-62.279988a21.352218 21.352218 0 0 1 30.199288 0l62.279988 62.279988a21.352218 21.352218 0 0 1-15.099644 36.451862z"
                        fill="#6E6E96" p-id="5075"></path>
                    <path d="M610.536457 313.051716l62.284017-62.279988 62.279988 62.279988" fill="#FFE770"
                          p-id="5076"></path>
                    <path
                        d="M735.100462 334.403934a21.299845 21.299845 0 0 1-15.099644-6.252574l-47.180344-47.180344-47.184373 47.180344a21.356247 21.356247 0 0 1-30.195259-30.199288l62.279988-62.279988a21.352218 21.352218 0 0 1 30.195259 0l62.279989 62.279988a21.352218 21.352218 0 0 1-15.095616 36.451862z"
                        fill="#6E6E96" p-id="5077"></path>
                    <path
                        d="M519.624353 45.947556c-3.831313 0-7.65054 0.068488-11.449623 0.173235 203.095851 5.785242 365.960901 172.231825 365.960901 376.72967 0 208.159953-168.746981 376.898877-376.906934 376.898877-208.155924 0-376.902905-168.738924-376.902906-376.898877a377.615989 377.615989 0 0 1 12.061989-94.924709 406.368966 406.368966 0 0 0-19.523179 124.777527c0 224.645477 182.114276 406.755723 406.759752 406.755724s406.755723-182.110247 406.755724-406.755724c0-224.645477-182.110247-406.755723-406.755724-406.755723z"
                        fill="#FF9900" opacity=".24" p-id="5078"></path>
                    <path
                        d="M517.811429 901.305321c-103.779837 0-204.98935-36.262512-284.979593-102.095831-78.906517-64.947001-133.733373-155.508606-154.380564-255.005914a451.740415 451.740415 0 0 1-9.366775-91.629216C69.084497 205.14647 270.383539 3.847428 517.811429 3.847428c247.42789 0 448.726932 201.299042 448.726932 448.726932 0 247.42789-201.299042 448.730961-448.726932 448.730961z m0-861.864149c-227.803993 0-413.137216 185.333223-413.137216 413.137217 0 28.43068 2.900679 56.821072 8.621461 84.397663 19.003474 91.576843 69.487369 174.951211 142.153398 234.757565 73.636951 60.604041 166.813196 93.981989 262.366386 93.981988 227.808022 0 413.137216-185.333223 413.137216-413.137216S745.619451 39.441172 517.811429 39.441172z"
                        fill="#6E6E96" p-id="5079"></path>
                    <path
                        d="M809.635818 752.069432m-135.542268 0a135.542268 135.542268 0 1 0 271.084536 0 135.542268 135.542268 0 1 0-271.084536 0Z"
                        fill="#FFE770" p-id="5080"></path>
                    <path
                        d="M809.635818 905.406558c-84.546726 0-153.337126-68.786372-153.337126-153.341154 0-84.546726 68.786372-153.337126 153.337126-153.337126s153.341155 68.786372 153.341155 153.337126c-0.004029 84.554783-68.7904 153.341155-153.341155 153.341154z m0-271.084536c-64.926857 0-117.74741 52.816524-117.74741 117.74741s52.816524 117.751439 117.74741 117.751439 117.751439-52.816524 117.751439-117.751439c-0.004029-64.930886-52.820553-117.74741-117.751439-117.74741z"
                        fill="#6E6E96" p-id="5081"></path>
                    <path
                        d="M218.864263 752.069432m-135.542268 0a135.542268 135.542268 0 1 0 271.084536 0 135.542268 135.542268 0 1 0-271.084536 0Z"
                        fill="#FFE770" p-id="5082"></path>
                    <path
                        d="M218.864263 905.406558c-84.550754 0-153.337126-68.786372-153.337126-153.341154 0-84.546726 68.786372-153.337126 153.337126-153.337126s153.337126 68.786372 153.337126 153.337126c0 84.554783-68.786372 153.341155-153.337126 153.341154z m0-271.084536c-64.926857 0-117.74741 52.816524-117.74741 117.74741s52.820553 117.751439 117.74741 117.751439 117.751439-52.816524 117.751439-117.751439c-0.004029-64.930886-52.824581-117.74741-117.751439-117.74741z"
                        fill="#6E6E96" p-id="5083"></path>
                    <path
                        d="M305.248085 455.213172a61.824743 28.845638 0 1 0 123.649486 0 61.824743 28.845638 0 1 0-123.649486 0Z"
                        fill="#FF0000" opacity=".18" p-id="5084"></path>
                    <path
                        d="M615.403151 455.213172a61.820714 28.845638 0 1 0 123.641429 0 61.820714 28.845638 0 1 0-123.641429 0Z"
                        fill="#FF0000" opacity=".18" p-id="5085"></path>
                    <path
                        d="M410.079418 993.43007h193.378577a16.114881 16.114881 0 0 0 0-32.229763h-193.378577a16.114881 16.114881 0 0 0 0 32.229763z"
                        fill="#6E6E96" opacity=".29" p-id="5086"></path>
                    <path
                        d="M675.435114 993.43007h56.402085a16.114881 16.114881 0 0 0 0-32.229763h-56.402085a16.114881 16.114881 0 0 0 0 32.229763z"
                        fill="#6E6E96" opacity=".17" p-id="5087"></path>
                    <path
                        d="M332.993882 961.200307h-44.315924a16.114881 16.114881 0 0 0 0 32.229763h44.315924a16.114881 16.114881 0 0 0 0-32.229763z"
                        fill="#6E6E96" opacity=".17" p-id="5088"/>
                  </svg>
                  已签到
                </template>
              </h3>
            </template>
          </a-card-meta>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script setup lang="ts">
import { useStore } from "vuex";
import {useRouter} from "vue-router";
import {UserControllerService} from "../../../generated";
import {onMounted, ref} from "vue";
import {EditTwoTone, EllipsisOutlined} from "@ant-design/icons-vue";


const store = useStore();
const router = useRouter();
const loginUser = store.state.user.loginUser;
const userScore = loginUser.score;

const ToSignView = () => {
  router.push('/user/sign');
}

const userSignRecords = ref([]);
const isSign = ref(false);
// 获取今天的日期，并且格式化为 YYYY-MM-DD 格式
const today = new Date();
const options = {year: 'numeric', month: '2-digit', day: '2-digit'};
const formattedDate = new Intl.DateTimeFormat('en-CA', options).format(today);
/**
 * 初始化签到记录
 */
const initSignRecords = async () => {
  const res = await UserControllerService.getSignRecordsUsingGet();
  if (res.code === 0) {
    userSignRecords.value = res.data;
    // console.log(" isSign.value 前", isSign.value);
    isSign.value = userSignRecords.value.includes(formattedDate);
    // console.log("userSignRecords.value",userSignRecords.value);
    // console.log(" isSign.value 后", isSign.value);
  }
}
onMounted(() => {
  initSignRecords();
})
</script>

<style scoped>
</style>